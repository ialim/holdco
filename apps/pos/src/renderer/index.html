<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>HoldCo POS</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="app">
      <header class="app-header">
        <div>
          <p class="kicker">HoldCo POS</p>
          <h1>Retail Console</h1>
          <p class="sub">Offline-first device and shift management.</p>
        </div>
        <div class="header-actions">
          <span id="apiStatus" class="status-pill">Offline</span>
          <button id="checkHealth" class="ghost">Check API</button>
          <button id="navActivation" class="ghost">Activation</button>
          <button id="navShift" class="ghost">Shift</button>
          <button id="navCheckout" class="ghost">Checkout</button>
          <button id="navSignOut" class="ghost">Sign out</button>
          <button id="flushQueue" class="primary">Flush Queue</button>
        </div>
      </header>

      <div id="offlineBanner" class="banner hidden">Offline: queued operations only.</div>
      <div class="status-bar">
        <div class="status-left">
          <div class="status-item">
            <span class="label">Device token</span>
            <span id="deviceTokenStatus" class="status-pill">Missing</span>
            <span id="deviceTokenExpiry" class="mono"></span>
          </div>
          <div class="status-item">
            <span class="label">Shift</span>
            <span id="shiftBannerStatus" class="status-pill">Closed</span>
            <span id="shiftBannerDetail" class="mono"></span>
          </div>
        </div>
        <div class="status-right">
          <div class="status-item">
            <span class="label">Queue</span>
            <span id="queueCount" class="mono">0</span>
          </div>
        </div>
      </div>

      <main>
        <section id="viewLoading" class="view active">
          <div class="card splash">
            <div class="spinner"></div>
            <h2>Loading POS configuration</h2>
            <p class="helper">Checking device provisioning and token status.</p>
          </div>
        </section>

        <section id="viewConfigMissing" class="view">
          <div class="card">
            <h2>Device not provisioned</h2>
            <p class="helper">Provision the device in Admin-Ops and ensure config.json is present.</p>
            <div id="configMissingMessage" class="helper error"></div>
            <div class="actions">
              <button id="reloadConfigMissing" class="primary">Reload config</button>
            </div>
          </div>
        </section>

        <section id="viewActivation" class="view">
          <div id="managerUnlockCard" class="card">
            <div class="card-header">
              <h2>Manager Access</h2>
            </div>
            <form id="managerUnlockForm" class="stack">
              <div class="form-row">
                <label for="managerUnlockEmployeeNo">Manager Employee No</label>
                <input id="managerUnlockEmployeeNo" type="text" placeholder="MGR-001" required />
              </div>
              <div class="form-row">
                <label for="managerUnlockPin">Manager PIN</label>
                <input id="managerUnlockPin" type="password" inputmode="numeric" required />
              </div>
              <button type="submit" class="primary">Unlock Configuration</button>
            </form>
            <div id="managerUnlockInfo" class="info-panel"></div>
            <div class="helper">Manager access is required to view device configuration.</div>
          </div>

          <div id="managerOnlyGrid" class="grid hidden">
            <div class="card">
              <div class="card-header">
                <h2>Configuration</h2>
                <button id="reloadConfig" class="ghost">Reload</button>
              </div>
              <div id="configStatus" class="helper"></div>
              <div class="config-grid">
                <div>
                  <label>API Base</label>
                  <div id="configApi" class="mono"></div>
                </div>
                <div>
                  <label>Group</label>
                  <div id="configGroup" class="mono"></div>
                </div>
                <div>
                  <label>Subsidiary</label>
                  <div id="configSubsidiary" class="mono"></div>
                </div>
                <div>
                  <label>Location</label>
                  <div id="configLocation" class="mono"></div>
                </div>
                <div>
                  <label>Channel</label>
                  <div id="configChannel" class="mono"></div>
                </div>
                <div>
                  <label>Category Facet</label>
                  <div id="configCategoryFacet" class="mono"></div>
                </div>
                <div>
                  <label>Device ID</label>
                  <div id="configDevice" class="mono"></div>
                </div>
              </div>
              <div class="actions">
                <button id="testPrinter" class="ghost" type="button">Print Test</button>
              </div>
              <div id="printerStatus" class="info-panel"></div>
              <div class="helper">Prints a test receipt using the configured printer.</div>
              <pre id="configRaw"></pre>
            </div>

            <div class="card">
              <div class="card-header">
                <h2>Manager Activation</h2>
              </div>
              <form id="managerActivateForm" class="stack">
                <div class="form-row">
                  <label for="managerEmployeeNo">Manager Employee No</label>
                  <input id="managerEmployeeNo" type="text" placeholder="MGR-001" required />
                </div>
                <div class="form-row">
                  <label for="managerPin">Manager PIN</label>
                  <input id="managerPin" type="password" inputmode="numeric" required />
                </div>
                <button type="submit" class="primary">Activate Device</button>
              </form>
              <div id="managerInfo" class="info-panel"></div>
              <div class="helper">Activation refreshes the device token for 24 hours.</div>
            </div>

            <div class="card">
              <div class="card-header">
                <h2>Set Cashier PIN</h2>
              </div>
              <form id="cashierPinForm" class="stack">
                <div class="form-row">
                  <label for="cashierPinEmployeeNo">Cashier Employee No</label>
                  <input id="cashierPinEmployeeNo" type="text" placeholder="EMP-001" required />
                </div>
                <div class="form-row">
                  <label for="cashierPinNew">New PIN</label>
                  <input id="cashierPinNew" type="password" inputmode="numeric" required />
                </div>
                <div class="form-row">
                  <label for="cashierPinConfirm">Confirm PIN</label>
                  <input id="cashierPinConfirm" type="password" inputmode="numeric" required />
                </div>
                <button type="submit" class="primary">Set PIN</button>
              </form>
              <div id="cashierPinInfo" class="info-panel"></div>
              <div class="helper">Requires manager permission.</div>
            </div>

            <div class="card">
              <div class="card-header">
                <h2>Device</h2>
                <button id="refreshDevice" class="ghost">Refresh</button>
              </div>
              <div class="helper">Provision devices in Admin-Ops.</div>
              <div id="deviceInfo" class="info-panel"></div>
            </div>
          </div>
        </section>

        <section id="viewCashier" class="view">
          <div class="grid">
            <div class="card">
              <div class="card-header">
                <h2>Cashier</h2>
                <div class="header-actions">
                  <span id="cashierStatus" class="status-pill">Signed out</span>
                  <button id="cashierLogout" class="ghost">Sign out</button>
                </div>
              </div>
              <form id="cashierLoginForm" class="stack">
                <div class="form-row">
                  <label for="cashierEmployeeNo">Employee No</label>
                  <input id="cashierEmployeeNo" type="text" placeholder="EMP-001" required />
                </div>
                <div class="form-row">
                  <label for="cashierPin">PIN</label>
                  <input id="cashierPin" type="password" inputmode="numeric" required />
                </div>
                <button type="submit" class="primary">Sign in</button>
              </form>
              <div id="cashierInfo" class="info-panel"></div>
              <div class="helper">Cashier JWT is sent via <span class="mono">X-Cashier-Token</span>.</div>
            </div>
          </div>
        </section>

        <section id="viewShift" class="view">
          <div class="grid">
            <div class="card">
              <div class="card-header">
                <h2>Shift</h2>
                <button id="refreshShift" class="ghost">Refresh</button>
              </div>
              <div id="shiftInfo" class="info-panel"></div>
              <form id="openShiftForm" class="stack">
                <div class="form-row">
                  <label for="openingFloat">Opening float</label>
                  <input id="openingFloat" type="number" min="0" step="0.01" />
                </div>
                <div class="form-row">
                  <label for="openNotes">Notes</label>
                  <input id="openNotes" type="text" />
                </div>
                <button type="submit" class="primary">Start Shift</button>
              </form>
              <form id="closeShiftForm" class="stack">
                <div class="form-row">
                  <label for="closingFloat">Closing float</label>
                  <input id="closingFloat" type="number" min="0" step="0.01" />
                </div>
                <div class="form-row">
                  <label for="closeNotes">Notes</label>
                  <input id="closeNotes" type="text" />
                </div>
                <button type="submit" class="danger">Close Shift</button>
              </form>
            </div>
            <div class="card">
              <div class="card-header">
                <h2>Shift Summary</h2>
                <button id="refreshSummary" class="ghost">Refresh</button>
              </div>
              <div id="shiftSummary" class="info-panel"></div>
            </div>
            <div class="card">
              <div class="card-header">
                <h2>Cash Drop</h2>
              </div>
              <form id="cashDropForm" class="stack">
                <div class="form-row">
                  <label for="cashDropAmount">Amount</label>
                  <input id="cashDropAmount" type="number" min="0" step="0.01" required />
                </div>
                <div class="form-row">
                  <label for="cashDropCurrency">Currency</label>
                  <input id="cashDropCurrency" type="text" maxlength="3" value="NGN" />
                </div>
                <div class="form-row">
                  <label for="cashDropReason">Reason</label>
                  <input id="cashDropReason" type="text" placeholder="Bank deposit" />
                </div>
                <button type="submit" class="primary">Record Cash Drop</button>
              </form>
              <div id="cashDropInfo" class="info-panel"></div>
              <div class="helper">Only available during an open shift.</div>
            </div>
          </div>
          <div class="actions">
            <button id="proceedCheckout" class="primary">Proceed to Checkout</button>
          </div>
        </section>

        <section id="viewCheckout" class="view">
          <div class="checkout-shell">
            <div class="checkout-top">
              <div class="checkout-field">
                <span class="field-label">Date</span>
                <div id="checkoutDate" class="field-value">-</div>
              </div>
              <div class="checkout-field">
                <span class="field-label">Warehouse</span>
                <div id="checkoutLocation" class="field-value">-</div>
              </div>
              <div class="checkout-field">
                <span class="field-label">Biller</span>
                <div id="checkoutBiller" class="field-value">-</div>
              </div>
              <div class="checkout-field">
                <span class="field-label">Customer</span>
                <div class="field-value field-select">
                  <span id="checkoutCustomer">Walk in customer</span>
                  <button id="addCustomer" class="ghost icon-button" type="button">+</button>
                </div>
              </div>
            </div>

            <div class="checkout-search-row">
              <div class="search-box">
                <input id="productSearch" type="text" placeholder="Scan/Search product by name/code/IMEI" />
                <button id="searchProducts" class="primary icon-button" type="button">Search</button>
              </div>
              <div class="filter-mode">
                <button id="filterCategory" class="tab-pill active" type="button">Category</button>
                <button id="filterBrand" class="tab-pill" type="button">Brand</button>
                <button id="filterFeatured" class="tab-pill" type="button">Featured</button>
              </div>
            </div>

            <div class="checkout-body">
              <div class="cart-panel">
                <div class="cart-head">
                  <span>Product</span>
                  <span>Price</span>
                  <span>Quantity</span>
                  <span>SubTotal</span>
                </div>
                <div id="cartItems" class="cart-items"></div>

                <div class="cart-summary-grid">
                  <div class="summary-item">
                    <span class="summary-label">Items</span>
                    <span id="cartCount" class="summary-value">0</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Total</span>
                    <span id="cartTotal" class="summary-value">0.00</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Discount</span>
                    <span id="cartDiscount" class="summary-value">0.00</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Tax</span>
                    <span id="cartTax" class="summary-value">0.00</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Shipping</span>
                    <span id="cartShipping" class="summary-value">0.00</span>
                  </div>
                </div>
                <div class="adjustment-grid">
                  <div class="form-row inline coupon-field">
                    <label for="discountInput">Discount</label>
                    <input id="discountInput" type="number" min="0" step="0.01" value="0" />
                  </div>
                  <div class="form-row inline">
                    <label for="taxRateInput">Tax %</label>
                    <input id="taxRateInput" type="number" min="0" step="0.01" value="0" />
                  </div>
                  <div class="form-row inline">
                    <label for="shippingInput">Shipping</label>
                    <input id="shippingInput" type="number" min="0" step="0.01" value="0" />
                  </div>
                  <div class="form-row inline">
                    <label for="couponCode">Coupon</label>
                    <div class="coupon-row">
                      <input id="couponCode" type="text" placeholder="PROMO2026" />
                      <button id="applyCoupon" class="ghost" type="button">Apply</button>
                    </div>
                    <div id="couponStatus" class="helper"></div>
                  </div>
                </div>
                <div class="grand-total">
                  <span>Grand Total</span>
                  <span id="cartGrandTotal">0.00</span>
                </div>

                <div class="order-meta">
                  <div class="form-row inline">
                    <label for="orderCurrency">Currency</label>
                    <input id="orderCurrency" type="text" maxlength="3" value="NGN" />
                  </div>
                  <div class="form-row inline">
                    <label for="orderNotes">Notes</label>
                    <input id="orderNotes" type="text" />
                  </div>
                </div>
                <div class="actions checkout-actions">
                  <button id="submitOrder" class="primary">Submit Order</button>
                  <button id="clearCart" class="ghost">Clear Cart</button>
                  <button id="printReceipt" class="ghost" type="button">Print Receipt</button>
                </div>
                <div id="orderStatus" class="helper"></div>
              </div>

              <div class="product-panel">
                <div class="product-panel-header">
                  <h3>Products</h3>
                  <span id="productCount" class="mono"></span>
                </div>
                <div id="productResults" class="product-grid"></div>
                <div id="filterDrawer" class="filter-drawer">
                  <div class="drawer-header">
                    <h4 id="filterDrawerTitle">Filter</h4>
                    <button id="closeFilterDrawer" class="ghost" type="button">Close</button>
                  </div>
                  <div id="categoryTabs" class="chip-row"></div>
                  <div id="brandTabs" class="chip-row hidden"></div>
                  <div id="featuredHint" class="chip-row hidden">
                    <span class="helper">Showing featured items only.</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="payment-bar">
              <button id="payCard" type="button" class="payment-button">Card</button>
              <button id="payCash" type="button" class="payment-button">Cash</button>
              <button id="payTransfer" type="button" class="payment-button">Transfer</button>
              <button id="paySplit" type="button" class="payment-button">Split</button>
              <button id="payInstallment" type="button" class="payment-button">Installment</button>
              <button id="payDeposit" type="button" class="payment-button">Deposit</button>
              <button id="payPoints" type="button" class="payment-button">Points</button>
              <div class="payment-spacer"></div>
              <button id="payDraft" type="button" class="payment-button ghost">Save Draft</button>
              <button id="payDrafts" type="button" class="payment-button ghost">
                Drafts
                <span id="draftCount" class="badge hidden">0</span>
              </button>
              <button id="payCancel" type="button" class="payment-button danger">Cancel</button>
              <button id="payRecent" type="button" class="payment-button ghost">Recent</button>
            </div>
          </div>

          <div class="card queue-card">
            <div class="card-header">
              <h2>Offline Queue</h2>
              <button id="refreshQueue" class="ghost">Refresh</button>
            </div>
            <div id="queueSummary" class="helper"></div>
            <pre id="queueOutput"></pre>
          </div>
        </section>
      </main>
    </div>

    <div id="customerModal" class="modal hidden">
      <div class="modal-card">
        <div class="modal-header">
          <h3>Select Customer</h3>
          <button id="closeCustomerModal" class="ghost" type="button">Close</button>
        </div>
        <div class="modal-body">
          <div class="search-box modal-search">
            <input id="customerSearch" type="text" placeholder="Search by name, email, or phone" />
            <button id="customerSearchBtn" class="primary icon-button" type="button">Search</button>
          </div>
          <div id="customerResults" class="list"></div>
          <div class="divider"></div>
          <div class="form-row">
            <label for="customerName">New customer</label>
            <input id="customerName" type="text" placeholder="Customer name" />
          </div>
          <div class="form-row">
            <label for="customerEmail">Email</label>
            <input id="customerEmail" type="email" placeholder="customer@example.com" />
          </div>
          <div class="form-row">
            <label for="customerPhone">Phone</label>
            <input id="customerPhone" type="text" placeholder="+234..." />
          </div>
          <div class="actions">
            <button id="createCustomer" class="primary" type="button">Create &amp; Select</button>
          </div>
        </div>
        <div class="modal-actions">
          <button id="setWalkIn" class="ghost" type="button">Walk in customer</button>
        </div>
      </div>
    </div>

    <div id="variantModal" class="modal hidden">
      <div class="modal-card">
        <div class="modal-header">
          <h3 id="variantModalTitle">Select Variant</h3>
          <button id="closeVariantModal" class="ghost" type="button">Close</button>
        </div>
        <div class="modal-body">
          <div id="variantList" class="list"></div>
        </div>
      </div>
    </div>

    <div id="paymentModal" class="modal hidden">
      <div class="modal-card">
        <div class="modal-header">
          <h3>Take Payment</h3>
          <button id="closePaymentModal" class="ghost" type="button">Close</button>
        </div>
        <form id="paymentForm" class="stack">
          <div class="summary-item">
            <span class="summary-label">Amount due</span>
            <span id="paymentTotal" class="summary-value">0.00</span>
          </div>
          <div class="form-row">
            <label for="paymentMethod">Method</label>
            <select id="paymentMethod">
              <option value="card">Card</option>
              <option value="transfer">Transfer</option>
              <option value="ussd">USSD</option>
              <option value="manual">Cash (Manual)</option>
            </select>
          </div>
          <div class="form-row">
            <label for="paymentProvider">Provider</label>
            <select id="paymentProvider">
              <option value="paystack">Paystack</option>
              <option value="flutterwave">Flutterwave</option>
              <option value="moniepoint">Moniepoint</option>
              <option value="monnify">Monnify</option>
              <option value="interswitch">Interswitch</option>
              <option value="manual">Manual</option>
            </select>
          </div>
          <div class="form-row">
            <label for="paymentAmount">Amount</label>
            <input id="paymentAmount" type="number" min="0" step="0.01" />
          </div>
          <div class="form-row">
            <label for="paymentCurrency">Currency</label>
            <input id="paymentCurrency" type="text" maxlength="3" value="NGN" />
          </div>
          <div class="form-row">
            <label for="paymentEmail">Customer email</label>
            <input id="paymentEmail" type="email" placeholder="customer@example.com" />
          </div>
          <div class="form-row">
            <label for="paymentCapture">Capture now</label>
            <select id="paymentCapture">
              <option value="false">No</option>
              <option value="true">Yes</option>
            </select>
          </div>
          <div id="paymentHint" class="helper"></div>
          <div class="actions">
            <button type="submit" class="primary">Proceed</button>
            <button id="cancelPayment" type="button" class="ghost">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div id="multiPaymentModal" class="modal hidden">
      <div class="modal-card wide">
        <div class="modal-header">
          <h3 id="multiPaymentTitle">Split Payment</h3>
          <button id="closeMultiPaymentModal" class="ghost" type="button">Close</button>
        </div>
        <form id="multiPaymentForm" class="stack">
          <div class="summary-item">
            <span class="summary-label">Amount due</span>
            <span id="multiPaymentTotal" class="summary-value">0.00</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Remaining</span>
            <span id="multiPaymentRemaining" class="summary-value">0.00</span>
          </div>
          <div class="form-row">
            <label for="multiPaymentCustomerEmail">Customer email</label>
            <input id="multiPaymentCustomerEmail" type="email" placeholder="customer@example.com" />
          </div>
          <div id="multiPaymentLines" class="stack"></div>
          <button id="addPaymentLine" type="button" class="ghost">Add Tender</button>
          <div id="multiPaymentReleaseRow" class="form-row hidden">
            <label class="checkbox">
              <input id="multiPaymentReleaseToggle" type="checkbox" />
              Release goods on deposit
            </label>
          </div>
          <div id="multiPaymentHint" class="helper"></div>
          <div class="actions">
            <button type="submit" class="primary">Proceed</button>
            <button id="cancelMultiPayment" type="button" class="ghost">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div id="refundModal" class="modal hidden">
      <div class="modal-card">
        <div class="modal-header">
          <h3>Refund Payment</h3>
          <button id="closeRefundModal" class="ghost" type="button">Close</button>
        </div>
        <form id="refundForm" class="stack">
          <div class="form-row">
            <label for="refundPaymentId">Payment intent ID</label>
            <input id="refundPaymentId" type="text" placeholder="pi_..." />
          </div>
          <div class="form-row">
            <label for="refundAmount">Amount</label>
            <input id="refundAmount" type="number" min="0" step="0.01" />
          </div>
          <div class="form-row">
            <label for="refundReason">Reason</label>
            <input id="refundReason" type="text" placeholder="Customer return" />
          </div>
          <div id="refundHint" class="helper"></div>
          <div class="actions">
            <button type="submit" class="primary">Submit refund</button>
            <button id="cancelRefund" type="button" class="ghost">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div id="recentModal" class="modal hidden">
      <div class="modal-card">
        <div class="modal-header">
          <h3>Recent Orders</h3>
          <button id="closeRecentModal" class="ghost" type="button">Close</button>
        </div>
        <div class="modal-body">
          <div class="actions">
            <button id="refreshRecent" class="ghost" type="button">Refresh</button>
          </div>
          <div id="recentOrders" class="list"></div>
        </div>
      </div>
    </div>

    <div id="draftModal" class="modal hidden">
      <div class="modal-card">
        <div class="modal-header">
          <h3>Draft Orders</h3>
          <button id="closeDraftModal" class="ghost" type="button">Close</button>
        </div>
        <div class="modal-body">
          <div class="actions">
            <button id="clearDrafts" class="ghost" type="button">Clear All</button>
          </div>
          <div id="draftList" class="list"></div>
        </div>
      </div>
    </div>

    <div id="toast" class="toast"></div>
    <script src="app.js"></script>
  </body>
</html>
